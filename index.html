<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio - Powered by Grow With Haider</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }

        .dashboard-card {
            background-color: #1e293b;
            border: 1px solid #334155;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            height: 100%;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            border-color: #6366f1;
            box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.3);
        }

        .tool-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f172a;
            z-index: 50;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .tool-view.active {
            transform: translateX(0);
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 4px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top-color: #6366f1;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- ================= DASHBOARD (ONLY 1 TOOL) ================= -->
    <div id="dashboard" class="flex-1 overflow-y-auto p-6 md:p-10 animate-fade-in flex items-center justify-center">
        <div class="max-w-4xl w-full">
            <div class="mb-12 text-center">
                <div class="inline-block mb-3 px-6 py-2 rounded-full bg-indigo-500/10 border border-indigo-500/30 shadow-[0_0_15px_rgba(99,102,241,0.3)]">
                    <span class="text-xs font-bold text-indigo-400 tracking-widest uppercase">âœ¨ Powered by Grow With Haider</span>
                </div>
                <h1 class="text-5xl font-black text-white mb-4 tracking-tight">AI Creator Studio</h1>
                <p class="text-slate-400 text-lg">Professional Bulk Image Generator</p>
            </div>

            <div class="grid grid-cols-1 max-w-md mx-auto">
                
                <!-- Tool 1: Bulk Image Gen -->
                <div onclick="openTool('bulk-tool')" class="dashboard-card p-10 rounded-3xl flex flex-col items-center text-center group border-indigo-500/30 hover:border-indigo-500 shadow-2xl">
                    <div class="w-24 h-24 rounded-2xl bg-indigo-600 text-white flex items-center justify-center text-5xl shadow-lg shadow-indigo-600/30 mb-6 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-layer-group"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-white mb-3">Bulk Image Generator</h3>
                    <p class="text-slate-400 leading-relaxed text-lg">Generate unlimited images at once. Auto-Enhance prompts for 8K quality. Direct one-click download.</p>
                    <span class="mt-8 px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold text-sm flex items-center gap-2 group-hover:bg-indigo-500 transition-colors">
                        Start Creating <i class="fa-solid fa-arrow-right"></i>
                    </span>
                </div>

            </div>
        </div>
    </div>


    <!-- ================= TOOL 1: BULK IMAGE GENERATOR ================= -->
    <div id="bulk-tool" class="tool-view">
        <div class="h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-6 shrink-0 z-20">
            <div class="flex items-center gap-4">
                <button onclick="closeTool('bulk-tool')" class="w-10 h-10 rounded-full hover:bg-slate-800 flex items-center justify-center text-slate-400 transition-colors">
                    <i class="fa-solid fa-arrow-left text-lg"></i>
                </button>
                <div class="flex flex-col">
                    <h2 class="font-bold text-white text-lg leading-none">Bulk Image Generator</h2>
                    <span class="text-[10px] text-indigo-400 font-medium mt-1">Powered by Grow With Haider</span>
                </div>
            </div>
        </div>

        <div class="flex-1 flex flex-col md:flex-row overflow-hidden bg-slate-950">
             
             <!-- Left Sidebar: Inputs -->
             <div class="w-full md:w-96 bg-slate-900 border-r border-slate-800 flex flex-col h-full shrink-0 z-10 p-6 shadow-2xl overflow-y-auto md:overflow-y-visible">
                 
                 <div class="mb-6">
                    <label class="text-xs font-bold text-slate-500 uppercase mb-2 block">Aspect Ratio</label>
                    <select id="bulk-ratio" class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-indigo-500">
                        <option value="1920x1080">Landscape (16:9) - HD</option>
                        <option value="1024x1024">Square (1:1) - HD</option>
                        <option value="1080x1920">Portrait (9:16) - HD</option>
                        <option value="3840x2160">Cinematic 4K (21:9)</option>
                    </select>
                 </div>

                 <div class="mb-6">
                     <label class="flex items-center gap-3 cursor-pointer bg-indigo-500/10 border border-indigo-500/30 p-4 rounded-xl hover:bg-indigo-500/20 transition-colors group">
                         <div class="relative flex items-center">
                             <input type="checkbox" id="auto-enhance" checked class="peer sr-only">
                             <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-indigo-600"></div>
                         </div>
                         <div class="flex flex-col">
                             <span class="text-sm text-white font-bold group-hover:text-indigo-300 transition-colors">ðŸš€ Auto-Enhance Quality</span>
                             <span class="text-[10px] text-slate-400">Turns simple text into 8K art</span>
                         </div>
                     </label>
                 </div>

                 <div class="flex-1 flex flex-col mb-6 min-h-[200px]">
                    <div class="flex justify-between items-end mb-2">
                        <label class="text-xs font-bold text-slate-500 uppercase block">Image Prompts (Unlimited)</label>
                        <span class="text-xs text-indigo-400 font-mono bg-indigo-500/10 px-2 py-1 rounded" id="prompt-count">0 Prompts</span>
                    </div>
                    <textarea id="bulk-prompt" class="flex-1 bg-slate-950 border border-slate-700 rounded-xl p-4 text-sm text-white outline-none focus:border-indigo-500 resize-none font-mono leading-relaxed placeholder-slate-600" placeholder="Paste your prompts here (one per line)...&#10;Example:&#10;A futuristic city in rain&#10;A cute robot eating pizza"></textarea>
                 </div>

                 <!-- Status -->
                 <div id="status-bar" class="hidden mb-4 bg-indigo-900/30 border border-indigo-500/30 rounded-xl p-3 text-center animate-pulse">
                     <span class="text-sm font-bold text-indigo-400 block" id="status-text">Preparing...</span>
                 </div>

                 <!-- Buttons -->
                 <div class="space-y-3">
                     <button onclick="generateBulk()" id="btn-bulk" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-indigo-600/20 transition-all flex items-center justify-center gap-2 active:scale-95 hover:-translate-y-0.5">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> Generate Images
                    </button>

                    <button onclick="downloadAllImages()" id="btn-download-all" class="hidden w-full bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-emerald-600/20 transition-all flex items-center justify-center gap-2 active:scale-95 hover:-translate-y-0.5 animate-pop">
                        <i class="fa-solid fa-file-zipper"></i> Download All (.zip)
                    </button>
                 </div>
             </div>

             <!-- Right Area: Grid -->
             <div class="flex-1 p-6 overflow-y-auto scroll-smooth bg-slate-950" id="grid-container">
                 <div id="bulk-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 pb-32">
                    <!-- Empty State -->
                    <div class="col-span-full flex flex-col items-center justify-center h-96 text-slate-600 border-2 border-dashed border-slate-800 rounded-3xl bg-slate-900/50">
                        <div class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mb-4 shadow-inner">
                            <i class="fa-solid fa-images text-4xl opacity-50"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-500">Ready to Create Magic</h3>
                        <p class="text-sm text-slate-600 mt-2 max-w-xs text-center">Enter prompts on the left sidebar to start generating unlimited high-quality images.</p>
                    </div>
                 </div>
             </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 

        // --- GLOBAL NAV ---
        function openTool(id) { document.getElementById(id).classList.add('active'); }
        function closeTool(id) { document.getElementById(id).classList.remove('active'); }

        // --- BULK GENERATOR LOGIC ---
        let generatedImages = [];

        const bulkInput = document.getElementById('bulk-prompt');
        if(bulkInput) {
             bulkInput.addEventListener('input', () => {
                const lines = bulkInput.value.split('\n').filter(l => l.trim()).length;
                document.getElementById('prompt-count').textContent = `${lines} Prompts`;
            });
        }

        // DIRECT DOWNLOAD HELPER
        async function forceDownload(url, filename) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(blobUrl);
            } catch (e) {
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.target = "_blank";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // --- IMAGEN 4 FUNCTION ---
        async function generateWithImagen4(prompt, aspectRatio) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
                    { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ instances: [{ prompt }], parameters: { sampleCount: 1, aspectRatio } }) }
                );
                if (!response.ok) throw new Error('Fail');
                const result = await response.json();
                return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
            } catch (e) { return null; }
        }

        async function generateBulk() {
            const prompts = document.getElementById('bulk-prompt').value.split('\n').filter(p=>p.trim());
            if(!prompts.length) return alert("Enter prompts first!");
            
            const btn = document.getElementById('btn-bulk');
            const grid = document.getElementById('bulk-grid');
            const statusText = document.getElementById('status-text');
            const statusBar = document.getElementById('status-bar');
            const ratio = document.getElementById('bulk-ratio').value;
            const [w, h] = ratio.split('x');
            const autoEnhance = document.getElementById('auto-enhance').checked;

            let ratioStr = "1:1";
            if(w==1920) ratioStr = "16:9";
            if(h==1920) ratioStr = "9:16";

            btn.disabled = true; 
            btn.innerHTML = '<div class="spinner border-white w-5 h-5 mr-2"></div> Processing...';
            statusBar.classList.remove('hidden');
            grid.innerHTML = ''; 
            generatedImages = []; 

            // 1. Create Pending Cards
            const cardIds = [];
            prompts.forEach((p, idx) => {
                const card = document.createElement('div');
                card.id = `card-${idx}`;
                // Full height placeholder
                card.className = 'bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 shadow-lg h-80 relative flex flex-col items-center justify-center opacity-50 animate-pop';
                card.innerHTML = `
                    <i class="fa-regular fa-clock text-4xl mb-3 text-slate-600"></i>
                    <span class="text-sm font-bold text-slate-500">Waiting...</span>
                    <div class="absolute bottom-0 w-full p-2 text-center bg-black/50 text-[10px] text-slate-400 truncate">${p}</div>
                `;
                grid.appendChild(card);
                cardIds.push(`card-${idx}`);
            });

            if(window.innerWidth < 768) {
                document.getElementById('grid-container').scrollIntoView({ behavior: 'smooth' });
            }

            // 2. Process Loop
            for(let i=0; i<prompts.length; i++) {
                const p = prompts[i];
                const card = document.getElementById(cardIds[i]);
                
                statusText.textContent = `Creating Image ${i+1} of ${prompts.length}...`;
                
                // Active State
                card.style.opacity = '1';
                card.className = 'bg-slate-800 rounded-2xl p-1 shadow-lg border border-indigo-500/50 h-auto animate-pulse transition-all';
                card.innerHTML = `
                    <div class="h-64 w-full bg-slate-900 rounded-xl flex flex-col items-center justify-center">
                        <div class="spinner border-indigo-500 mb-3"></div>
                        <span class="text-sm font-bold text-indigo-400">Generating...</span>
                    </div>
                `;
                card.scrollIntoView({behavior:'smooth', block:'center'});

                let finalPrompt = p;
                if(autoEnhance) {
                    finalPrompt = `${p}, cinematic lighting, hyper-realistic, 8k, masterpiece, sharp focus, detailed texture, artstation HQ`;
                }

                // TRY IMAGEN 4 FIRST
                let url = await generateWithImagen4(finalPrompt, ratioStr);
                let sourceName = "Imagen 4";

                // FALLBACK TO FLUX (POLLINATIONS) IF FAILED
                if (!url) {
                    sourceName = "Flux HD";
                    const seed = Math.floor(Math.random() * 999999);
                    if(autoEnhance) finalPrompt += ", flux style"; 
                    // Using Pollinations Flux - Unlimited & Free
                    url = `https://image.pollinations.ai/prompt/${encodeURIComponent(finalPrompt)}?width=${w}&height=${h}&model=flux&seed=${seed}&nologo=true&t=${Date.now()}`;
                }

                await new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = () => {
                        const filename = `image_${i+1}_${Math.floor(Math.random()*1000)}.jpg`;
                        generatedImages.push({ url: url, name: filename });
                        
                        card.className = "bg-slate-800 rounded-2xl p-3 shadow-xl border border-slate-700 flex flex-col gap-3 animate-pop group h-auto transition-all hover:border-indigo-500/50 hover:shadow-2xl hover:shadow-indigo-500/10";
                        card.innerHTML = `
                            <div class="relative w-full overflow-hidden rounded-xl bg-slate-950 border border-white/5 group-hover:border-white/10 transition-colors">
                                <img src="${url}" class="w-full h-auto object-contain transition-transform duration-700 group-hover:scale-105 cursor-pointer" onclick="window.open('${url}', '_blank')">
                                <div class="absolute top-3 right-3 bg-black/80 text-white text-[10px] font-bold px-2.5 py-1 rounded-lg backdrop-blur-md border border-white/10 shadow-lg">${sourceName}</div>
                            </div>
                            <div class="flex flex-col gap-2 mt-auto w-full">
                                <p class="text-xs text-slate-400 truncate font-mono px-1" title="${p}">${p}</p>
                                <button onclick="forceDownload('${url}', '${filename}')" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl text-sm font-bold text-center transition-all shadow-lg hover:shadow-indigo-500/25 flex items-center justify-center gap-2 active:scale-95 group/btn">
                                    <i class="fa-solid fa-download group-hover/btn:animate-bounce"></i> Download
                                </button>
                            </div>
                        `;
                        resolve();
                    };
                    img.onerror = () => {
                        // Retry once internally if failed
                        setTimeout(() => {
                             img.src = url + "&retry=1";
                        }, 1000);
                        
                        // Fallback UI if keeps failing
                        setTimeout(() => {
                             if(!img.complete) {
                                card.innerHTML = `<div class="h-64 flex flex-col items-center justify-center text-red-400"><i class="fa-solid fa-triangle-exclamation text-3xl mb-2"></i><span>Failed</span></div>`;
                                resolve(); 
                             }
                        }, 8000);
                    };
                    img.src = url;
                });
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Generate Images';
            statusText.textContent = "Generation Complete!";
            
            if(generatedImages.length > 0) {
                document.getElementById('btn-download-all').classList.remove('hidden');
            }
            
            setTimeout(() => {
                 statusBar.classList.add('hidden');
            }, 3000);
        }

        async function downloadAllImages() {
            if(generatedImages.length === 0) return alert("No images to download");
            const btn = document.getElementById('btn-download-all');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="spinner w-4 h-4 border-white mr-2"></div> Zipping...';
            btn.disabled = true;

            try {
                const zip = new JSZip();
                const folder = zip.folder("AI_Images");
                
                // Concurrent fetching for zip speed
                const promises = generatedImages.map(async (imgObj) => {
                    try {
                        const response = await fetch(imgObj.url);
                        const blob = await response.blob();
                        folder.file(imgObj.name, blob);
                    } catch(e) { console.error("Skip", imgObj.url); }
                });

                await Promise.all(promises);
                const content = await zip.generateAsync({ type: "blob" });
                saveAs(content, "Bulk_Images.zip");
            } catch (e) {
                alert("Error creating zip file. Please try individual downloads.");
            }
            btn.innerHTML = originalText; 
            btn.disabled = false;
        }
    </script>
</body>
</html>
